require 'securerandom'
require 'net/http'
require 'base64'
require 'ecdsa'

def bin_to_hex(s)
    s.unpack('C*').map { |b| b.to_s(16).rjust(2, '0') }.join
end
def bin_to_i(s)
    bin_to_hex(s).to_i(16)
end
results = {}
def register(u)
    uri = URI('http://ptl-f47d7330-23b1eab8.libcurl.so/register')
    res = Net::HTTP.post_form(uri, 'username' => u, 'password' => 'password')
    cookie = res['set-cookie'][/secure=(.*?);/,1]
    uncooked = URI.unescape(cookie)
    user,sig = Base64.decode64(uncooked).split('--')
    sigdecode =  ECDSA::Format::SignatureDerString.decode(sig)
    return cookie, sigdecode.r, sigdecode.s
end

def getranduser
    (0...15).map { ('a'..'z').to_a[rand(26)] }.join
end

loop do
    cookie, r, s = register(getranduser)
    printf "%s %d %d\n", cookie, r, s
    break if results.key?(r)
    results[r] = 1
end

